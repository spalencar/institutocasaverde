<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="imagens/favicon.png">
    <title>Atividades e Eventos | Instituto Casa Verde</title>
    <link rel="stylesheet" href="css/atividades.css">
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav id="main-nav">
      <div class="nav-container">
        <a href="index.html" class="logo-link">
          <img src="imagens/logo.png" alt="Logotipo Instituto Casa Verde" class="logo-img"/>
          <span class="logo-text">INSTITUTO CASA VERDE</span>
        </a>
        <button class="hamburger" aria-label="Abrir menu">&#9776;</button>
        <div class="nav-links">
          <a href="index.html" class="nav-item">INÍCIO</a>
          <a href="sobre.html" class="nav-item">SOBRE NÓS</a>
          <a href="atividades.html" class="nav-item active">ATIVIDADES</a>
          <a href="cursos.html" class="nav-item">CURSOS</a>
          <a href="doacoes.html" class="nav-item special-link">DOAÇÕES</a>
          <a href="contato.html" class="nav-item">CONTATO</a>
        </div>
      </div>
    </nav>

    <main>
      <header id="hero-page">
        <h1 id="hero-title">Carregando...</h1>
        <p id="hero-phrase">Carregando...</p>
      </header>

      <section class="activities-section">
        <h2>Próximos Eventos</h2>

        <div class="filter-container" id="filter-container">
          <button class="filter-button active" data-filter="todos">
            Mostrar Todos
          </button>
        </div>

        <div class="cards-grid" id="proximos-container"></div>
      </section>

      <section class="activities-section">
        <h2>Eventos Realizados</h2>
        <div class="cards-grid" id="realizados-container"></div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="footer-container">
        <div class="footer-col logo-text">
          <h4>INSTITUTO CASA VERDE</h4>
          <p id="footer-text-icv">Carregando...</p>
        </div>

        <div class="footer-col links">
          <h3>LINKS RÁPIDOS</h3>
          <ul>
            <li><a href="sobre.html">Sobre Nós</a></li>
            <li><a href="atividades.html">Atividades</a></li>
            <li><a href="cursos.html">Cursos</a></li>
            <li><a href="doacoes.html">Doações</a></li>
          </ul>
        </div>

        <div class="footer-col contact">
          <h3>CONTATO</h3>
          <p id="footer-endereco">Endereço: Carregando...</p>
          <p id="footer-email">E-mail: Carregando...</p>
          <p id="footer-telefone">Telefone: Carregando...</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p id="footer-copyright">
          Copyright ©2025 Instituto Casa Verde. Todos os direitos reservados.
        </p>
      </div>
    </footer>

    <script>
      const API_URL = '/api/content';
      let proximosEventos = [];

      document.addEventListener("DOMContentLoaded", () => {
        // Lógica do Menu Hamburguer
        const hamburger = document.querySelector(".hamburger");
        const navLinks = document.querySelector(".nav-links");

        if (hamburger && navLinks) {
          hamburger.addEventListener("click", () => {
            navLinks.classList.toggle("open");
          });
        }

        // Inicia o carregamento do conteúdo dinâmico
        fetchContentAndRenderActivities();
      });

      async function fetchContentAndRenderActivities() {
        try {
          const response = await fetch(API_URL);
          if (!response.ok) {
            throw new Error(`Erro ao buscar dados: ${response.status}`);
          }
          const data = await response.json();
          const atividades = data.atividades;
          const footerData = data.footer;

          if (!atividades || !footerData) {
            console.error(
              "Dados 'atividades' ou 'footer' não encontrados na API."
            );
            return;
          }

          // Salva os próximos eventos globalmente para o filtro
          proximosEventos = atividades.proximos || [];

          // --- Renderização do HEADER/HERO ---
          document.getElementById("hero-title").textContent =
            atividades.tituloHero;
          document.getElementById("hero-phrase").textContent =
            atividades.fraseHero;
          document.getElementById(
            "hero-page"
          ).style.backgroundImage = `url(${atividades.imagemHero})`;

          // --- Renderização do FOOTER ---
          renderFooter(footerData);

          // --- Renderização dos Eventos ---
          renderProximosEventos(proximosEventos);
          renderEventosRealizados(atividades.realizados || []);

          // --- Configuração dos Filtros (Sugestão de Funcionalidade) ---
          setupFilters(proximosEventos);
        } catch (error) {
          console.error(
            "Erro ao processar o conteúdo da página Atividades:",
            error
          );
        }
      }

      // Função de Renderização dos PRÓXIMOS EVENTOS
      function renderProximosEventos(eventos) {
        const container = document.getElementById("proximos-container");
        container.innerHTML = "";

        eventos.forEach((evento) => {
          const card = document.createElement("div");
          card.classList.add("activity-card");
          card.setAttribute("data-tema", evento.tema); // Adiciona tema para o filtro

          card.innerHTML = `
                    <img src="${evento.imagem}" alt="Imagem do evento: ${evento.titulo}" class="card-image">
                    <div class="card-content">
                        <span class="tag">${evento.tema}</span>
                        <h3>${evento.titulo}</h3>
                        <div class="proximo-info">
                            <span><strong>Data:</strong> ${evento.data}</span>
                            <span><strong>Horário:</strong> ${evento.horario}</span>
                            <span><strong>Local:</strong> ${evento.local}</span>
                        </div>
                        <p>${evento.descricao}</p>
                        <a href="${evento.linkContato}" target="_blank" class="card-button">Saiba Mais</a>
                    </div>
                `;
          container.appendChild(card);
        });
      }

      // Função de Renderização dos EVENTOS REALIZADOS
      function renderEventosRealizados(eventos) {
        const container = document.getElementById("realizados-container");
        container.innerHTML = "";

        eventos.forEach((evento) => {
          const card = document.createElement("div");
          card.classList.add("activity-card");

          card.innerHTML = `
                    <img src="${evento.imagem}" alt="Imagem do evento: ${evento.titulo}" class="card-image">
                    <div class="card-content">
                        <h3>${evento.titulo}</h3>
                        <p class="realizado-data">${evento.data}</p>
                        <p>${evento.descricao}</p>
                    </div>
                `;
          container.appendChild(card);
        });
      }

      // Função de Renderização do FOOTER
      function renderFooter(footerData) {
        document.getElementById("footer-text-icv").textContent =
          footerData.textoIc_Text;
        document.getElementById(
          "footer-endereco"
        ).textContent = `Endereço: ${footerData.endereco}`;
        document.getElementById(
          "footer-email"
        ).textContent = `E-mail: ${footerData.email}`;
        document.getElementById(
          "footer-telefone"
        ).textContent = `Telefone: ${footerData.telefone}`;
        document.getElementById(
          "footer-copyright"
        ).textContent = `Copyright ©${footerData.copyrightAno} Instituto Casa Verde. Todos os direitos reservados.`;
      }

      // Lógica dos Filtros (Sugestão de Funcionalidade)
      function setupFilters(eventos) {
        const filterContainer = document.getElementById("filter-container");
        const temasUnicos = [...new Set(eventos.map((e) => e.tema))];

        temasUnicos.forEach((tema) => {
          const button = document.createElement("button");
          button.classList.add("filter-button");
          button.textContent = tema;
          button.setAttribute("data-filter", tema.toLowerCase());
          filterContainer.appendChild(button);
        });

        filterContainer.addEventListener("click", (e) => {
          if (e.target.classList.contains("filter-button")) {
            const selectedFilter = e.target.getAttribute("data-filter");

            // Atualiza o estado dos botões
            document
              .querySelectorAll(".filter-button")
              .forEach((btn) => btn.classList.remove("active"));
            e.target.classList.add("active");

            filterActivities(selectedFilter);
          }
        });
      }

      function filterActivities(filter) {
        const cards = document.querySelectorAll(
          "#proximos-container .activity-card"
        );

        cards.forEach((card) => {
          const tema = card.getAttribute("data-tema").toLowerCase();

          if (filter === "todos" || tema === filter) {
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
      }
    </script>
  </body>
</html>
